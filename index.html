<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusTrend UEW - Connect with Students</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background-color: #f0f2f5;
            min-height: 100vh;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #1877f2, #42b72a);
            padding: 12px 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }

        .logo {
            font-size: 22px;
            font-weight: bold;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 26px;
        }

        .logo-subtitle {
            font-size: 11px;
            font-weight: normal;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .upload-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            color: #1877f2;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Notification Bell */
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            transition: all 0.3s;
        }

        .notification-bell:hover {
            background: rgba(255,255,255,0.3);
        }

        .notification-bell i {
            font-size: 20px;
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #e74c3c;
            color: white;
            font-size: 11px;
            font-weight: bold;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1877f2;
        }

        .notification-badge.hidden {
            display: none;
        }

        /* Notification Dropdown */
        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            width: 360px;
            max-height: 480px;
            overflow: hidden;
            display: none;
            z-index: 2000;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #e4e6e9;
        }

        .notification-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: #050505;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
        }

        .notification-action-btn {
            padding: 6px 12px;
            background: none;
            border: none;
            color: #1877f2;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .notification-action-btn:hover {
            background: #e7f3ff;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
            border-left: 3px solid transparent;
        }

        .notification-item:hover {
            background: #f0f2f5;
        }

        .notification-item.unread {
            background: #e7f3ff;
            border-left-color: #1877f2;
        }

        .notification-item.unread:hover {
            background: #d0e8ff;
        }

        .notification-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            flex-shrink: 0;
            position: relative;
        }

        .notification-icon-badge {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: white;
            border: 2px solid white;
        }

        .notification-icon-badge.like { background: #1877f2; }
        .notification-icon-badge.comment { background: #42b72a; }
        .notification-icon-badge.follow { background: #9c27b0; }
        .notification-icon-badge.share { background: #ff9800; }

        .notification-content {
            flex: 1;
            min-width: 0;
        }

        .notification-text {
            font-size: 14px;
            color: #050505;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .notification-text strong {
            font-weight: 600;
        }

        .notification-time {
            font-size: 12px;
            color: #1877f2;
            font-weight: 500;
        }

        .notification-unread-dot {
            width: 12px;
            height: 12px;
            background: #1877f2;
            border-radius: 50%;
            flex-shrink: 0;
            align-self: center;
        }

        .no-notifications {
            text-align: center;
            padding: 40px 20px;
            color: #65676b;
        }

        .no-notifications i {
            font-size: 48px;
            color: #bcc0c4;
            margin-bottom: 15px;
        }

        .no-notifications p {
            font-size: 15px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 2px solid white;
            font-size: 14px;
        }

        .user-name {
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            max-width: 1200px;
            margin: 70px auto 20px;
            padding: 20px;
            gap: 20px;
        }

        /* Sidebar - Trends */
        .sidebar {
            width: 280px;
            flex-shrink: 0;
        }

        .trends-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 90px;
        }

        .trends-header {
            font-size: 18px;
            font-weight: 700;
            color: #050505;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trends-header i {
            color: #1877f2;
        }

        .trend-item {
            padding: 12px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .trend-item:hover {
            background: #f0f2f5;
        }

        .trend-category {
            font-size: 12px;
            color: #65676b;
        }

        .trend-name {
            font-size: 15px;
            font-weight: 600;
            color: #050505;
            margin: 3px 0;
        }

        .trend-posts {
            font-size: 12px;
            color: #65676b;
        }

        .departments-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 15px;
        }

        .departments-header {
            font-size: 16px;
            font-weight: 700;
            color: #050505;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .department-tag {
            display: inline-block;
            padding: 6px 12px;
            background: #e7f3ff;
            color: #1877f2;
            border-radius: 15px;
            font-size: 12px;
            margin: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .department-tag:hover {
            background: #1877f2;
            color: white;
        }

        .department-tag.active {
            background: #1877f2;
            color: white;
        }

        /* Feed Area */
        .feed-container {
            flex: 1;
            max-width: 680px;
        }

        .feed-header {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .feed-title {
            font-size: 18px;
            font-weight: 700;
            color: #050505;
        }

        .feed-filter {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: none;
            background: #f0f2f5;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            color: #65676b;
            font-weight: 500;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #1877f2;
            color: white;
        }

        /* Post Card */
        .post-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: box-shadow 0.3s;
        }

        .post-header {
            display: flex;
            align-items: center;
            padding: 15px;
            gap: 10px;
        }

        .post-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .post-user-info {
            flex: 1;
            min-width: 0;
        }

        .post-username-container {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .post-username {
            font-weight: 600;
            color: #050505;
            font-size: 15px;
            cursor: pointer;
        }

        .post-username:hover {
            text-decoration: underline;
        }

        .follow-btn {
            padding: 4px 12px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .follow-btn:hover {
            background: #166fe5;
        }

        .follow-btn.following {
            background: #e4e6e9;
            color: #050505;
        }

        .follow-btn.following:hover {
            background: #ffebe9;
            color: #dc3545;
        }

        .post-meta {
            font-size: 13px;
            color: #65676b;
            display: flex;
            align-items: center;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 2px;
        }

        .post-department {
            background: #e7f3ff;
            color: #1877f2;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }

        .post-options {
            padding: 10px;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.3s;
            position: relative;
            flex-shrink: 0;
        }

        .post-options:hover {
            background: #f0f2f5;
        }

        .options-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
            min-width: 200px;
            display: none;
            z-index: 100;
        }

        .options-dropdown.show {
            display: block;
        }

        .option-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .option-item:hover {
            background: #f0f2f5;
        }

        .option-item i {
            width: 20px;
            color: #65676b;
        }

        .option-item.delete {
            color: #e74c3c;
        }

        .option-item.delete i {
            color: #e74c3c;
        }

        /* Post Content with See More */
        .post-content {
            padding: 0 15px 15px;
            font-size: 15px;
            line-height: 1.5;
            color: #050505;
        }

        .post-content-text {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .post-content-text.collapsed {
            display: -webkit-box;
          
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .see-more-btn {
            color: #65676b;
            font-weight: 600;
            cursor: pointer;
            border: none;
            background: none;
            padding: 0;
            margin-top: 5px;
            font-size: 14px;
            display: block;
        }

        .see-more-btn:hover {
            text-decoration: underline;
            color: #1877f2;
        }

        .post-image-container {
            width: 100%;
            background: #f0f2f5;
            position: relative;
            overflow: hidden;
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            display: block;
        }

        .post-image-placeholder {
            width: 100%;
            height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .post-image-placeholder i {
            font-size: 80px;
            margin-bottom: 15px;
            opacity: 0.8;
        }

        .post-image-placeholder span {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Star Rating Badge - FIXED AND ENHANCED */
        .star-rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 4px 10px;
            border-radius: 15px;
            margin-left: 8px;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.4);
            animation: starPulse 2s ease-in-out infinite;
            vertical-align: middle;
        }

        .star-rating-badge i {
            color: white;
            font-size: 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .star-rating-badge.stars-2 {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
        }

        .star-rating-badge.stars-3 {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        .star-rating-badge.stars-4 {
            background: linear-gradient(135deg, #e91e63, #c2185b);
        }

        .star-rating-badge.stars-5 {
            background: linear-gradient(135deg, #9c27b0, #7b1fa2);
            animation: starGlow 1.5s ease-in-out infinite;
        }

        @keyframes starPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes starGlow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(156, 39, 176, 0.4);
            }
            50% { 
                transform: scale(1.08);
                box-shadow: 0 4px 20px rgba(156, 39, 176, 0.6);
            }
        }

        .star-rating-label {
            font-size: 10px;
            color: white;
            font-weight: 600;
            margin-left: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Star milestone notification */
        .star-milestone {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            text-align: center;
            z-index: 3000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .star-milestone.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .star-milestone-stars {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .star-milestone-text {
            font-size: 18px;
            font-weight: 600;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            color: #65676b;
            font-size: 14px;
        }

        .like-icons {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .like-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        .like-icon.like { background: #1877f2; }
        .like-icon.love { background: #f33e58; }

        .post-actions {
            display: flex;
            border-top: 1px solid #e4e6e9;
            padding: 5px;
        }

        .action-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: 15px;
            color: #65676b;
            font-weight: 600;
            transition: background 0.3s;
        }

        .action-btn:hover {
            background: #f0f2f5;
        }

        .action-btn.liked {
            color: #1877f2;
        }

        .action-btn.liked i {
            font-weight: 900;
        }

        .action-btn i {
            font-size: 20px;
        }

        /* Comments Section */
        .comments-section {
            padding: 10px 15px 15px;
            border-top: 1px solid #e4e6e9;
            display: none;
        }

        .comments-section.show {
            display: block;
        }

        .comment-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .comment-input-wrapper {
            flex: 1;
            display: flex;
            background: #f0f2f5;
            border-radius: 20px;
            padding: 8px 15px;
            align-items: center;
        }

        .comment-input {
            flex: 1;
            border: none;
            background: none;
            font-size: 14px;
            outline: none;
        }

        .comment-submit {
            border: none;
            background: none;
            color: #1877f2;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        .comment-submit:disabled {
            color: #bcc0c4;
            cursor: not-allowed;
        }

        .comments-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .comments-count-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e4e6e9;
        }

        .comments-count {
            font-weight: 600;
            color: #050505;
            font-size: 14px;
        }

        .comments-sort {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #65676b;
            font-size: 13px;
            cursor: pointer;
        }

        .comments-sort:hover {
            text-decoration: underline;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .comment-body {
            flex: 1;
        }

        .comment-content {
            background: #f0f2f5;
            padding: 10px 15px;
            border-radius: 18px;
            display: inline-block;
            max-width: 100%;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment-username {
            font-weight: 600;
            font-size: 13px;
            color: #050505;
        }

        .comment-follow-btn {
            padding: 2px 8px;
            background: transparent;
            color: #1877f2;
            border: 1px solid #1877f2;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .comment-follow-btn:hover {
            background: #1877f2;
            color: white;
        }

        .comment-follow-btn.following {
            background: #e4e6e9;
            color: #65676b;
            border-color: #e4e6e9;
        }

        .comment-text {
            font-size: 14px;
            color: #050505;
            margin-top: 2px;
            word-wrap: break-word;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
            padding-left: 15px;
            margin-top: 5px;
        }

        .comment-action {
            font-size: 12px;
            color: #65676b;
            cursor: pointer;
            font-weight: 600;
        }

        .comment-action:hover {
            text-decoration: underline;
        }

        .comment-action.liked {
            color: #1877f2;
        }

        /* Replies */
        .replies-container {
            margin-left: 45px;
            margin-top: 10px;
        }

        .reply {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .reply-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .reply-input-container {
            display: none;
            margin-left: 45px;
            margin-top: 10px;
            gap: 8px;
            align-items: center;
        }

        .reply-input-container.show {
            display: flex;
        }

        .reply-input-wrapper {
            flex: 1;
            display: flex;
            background: #f0f2f5;
            border-radius: 20px;
            padding: 6px 12px;
            align-items: center;
        }

        .reply-input {
            flex: 1;
            border: none;
            background: none;
            font-size: 13px;
            outline: none;
        }

        .view-more-comments {
            text-align: center;
            padding: 10px;
            color: #65676b;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .view-more-comments:hover {
            text-decoration: underline;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid #e4e6e9;
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #050505;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e4e6e9;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: #d8dadf;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-user {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #050505;
            margin-bottom: 8px;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            cursor: pointer;
            background: white;
        }

        .form-select:focus {
            border-color: #1877f2;
        }

        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px 15px;
            border: 1px solid #dddfe2;
            border-radius: 8px;
            font-size: 15px;
            resize: vertical;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
        }

        .form-textarea:focus {
            border-color: #1877f2;
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: #65676b;
            margin-top: 5px;
        }

        .image-upload-area {
            border: 2px dashed #dddfe2;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f7f8fa;
        }

        .image-upload-area:hover {
            border-color: #1877f2;
            background: #e7f3ff;
        }

        .image-upload-area.has-image {
            padding: 10px;
            border-style: solid;
        }

        .upload-icon {
            font-size: 48px;
            color: #1877f2;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 16px;
            color: #050505;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .upload-subtext {
            font-size: 13px;
            color: #65676b;
        }

        .image-preview-container {
            position: relative;
            display: none;
        }

        .image-preview {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 8px;
        }

        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.6);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .remove-image-btn:hover {
            background: rgba(0,0,0,0.8);
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e4e6e9;
        }

        .post-submit-btn {
            width: 100%;
            padding: 12px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .post-submit-btn:hover {
            background: #166fe5;
        }

        .post-submit-btn:disabled {
            background: #e4e6e9;
            color: #bcc0c4;
            cursor: not-allowed;
        }

        /* Hidden file input */
        .hidden-input {
            display: none;
        }

        /* Share Modal */
        .share-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .share-option:hover {
            background: #f0f2f5;
        }

        .share-option-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .share-option-icon.timeline { background: #e7f3ff; color: #1877f2; }
        .share-option-icon.message { background: #e8f5e9; color: #43a047; }
        .share-option-icon.copy { background: #fff3e0; color: #ef6c00; }

        .share-option-text h4 {
            font-size: 15px;
            color: #050505;
            margin-bottom: 3px;
        }

        .share-option-text p {
            font-size: 13px;
            color: #65676b;
        }

        /* Profile Modal */
        .profile-modal-content {
            text-align: center;
            padding: 20px;
        }

        .profile-modal-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 36px;
            margin: 0 auto 15px;
        }

        .profile-modal-name {
            font-size: 24px;
            font-weight: 700;
            color: #050505;
            margin-bottom: 5px;
        }

        .profile-modal-department {
            font-size: 14px;
            color: #65676b;
            margin-bottom: 15px;
        }

        .profile-modal-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #050505;
        }

        .profile-stat-label {
            font-size: 13px;
            color: #65676b;
        }

        .profile-follow-btn {
            padding: 10px 40px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .profile-follow-btn:hover {
            background: #166fe5;
        }

        .profile-follow-btn.following {
            background: #e4e6e9;
            color: #050505;
        }

        .profile-follow-btn.following:hover {
            background: #ffebe9;
            color: #dc3545;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 3000;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            background: #43a047;
        }

        .toast.error {
            background: #e53935;
        }

        /* No posts message */
        .no-posts {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .no-posts i {
            font-size: 60px;
            color: #bcc0c4;
            margin-bottom: 20px;
        }

        .no-posts h3 {
            font-size: 20px;
            color: #050505;
            margin-bottom: 10px;
        }

        .no-posts p {
            color: #65676b;
            font-size: 15px;
        }

        /* No trends message */
        .no-trends {
            text-align: center;
            padding: 20px;
            color: #65676b;
            font-size: 14px;
        }

        /* Own post badge */
        .own-post-badge {
            background: #e7f3ff;
            color: #1877f2;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
        }

        /* Like test buttons for demo */
        .like-test-container {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .like-test-btn {
            padding: 4px 8px;
            font-size: 10px;
            background: #e7f3ff;
            color: #1877f2;
            border: 1px solid #1877f2;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .like-test-btn:hover {
            background: #1877f2;
            color: white;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }
        }

        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .feed-container {
                max-width: 100%;
                order: 1;
            }

            .trends-card {
                position: static;
            }
        }

        @media (max-width: 600px) {
            .header {
                padding: 10px 15px;
            }

            .logo {
                font-size: 18px;
            }

            .logo-subtitle {
                display: none;
            }

            .upload-btn span {
                display: none;
            }

            .upload-btn {
                padding: 10px 15px;
            }

            .user-name {
                display: none;
            }

            .main-layout {
                padding: 10px;
                margin-top: 65px;
            }

            .action-btn span {
                display: none;
            }

            .feed-filter {
                display: none;
            }

            .follow-btn {
                padding: 3px 10px;
                font-size: 11px;
            }

            .notification-dropdown {
                width: 300px;
                right: -50px;
            }

            .star-rating-badge {
                padding: 3px 8px;
            }

            .star-rating-badge i {
                font-size: 10px;
            }

            .star-rating-label {
                font-size: 9px;
            }
        }

        @media (max-width: 400px) {
            .notification-dropdown {
                width: 280px;
                right: -80px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <i class="fas fa-graduation-cap"></i>
            <div>
                <span>CampusTrend</span>
                <div class="logo-subtitle">University of Education, Winneba</div>
            </div>
        </div>
        <div class="header-right">
            <button class="upload-btn" id="openUploadModal">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Upload</span>
            </button>
            
            <!-- Notification Bell -->
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationBadge">0</span>
                
                <!-- Notification Dropdown -->
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h3>Notifications</h3>
                        <div class="notification-actions">
                            <button class="notification-action-btn" id="markAllRead">Mark all read</button>
                        </div>
                    </div>
                    <div class="notification-list" id="notificationList">
                        <!-- Notifications will be rendered here -->
                    </div>
                </div>
            </div>
            
            <div class="user-profile" id="userProfile">
                <div class="user-avatar" id="currentUserAvatar">U</div>
                <span class="user-name" id="currentUserName">User</span>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <main class="main-layout">
        <!-- Sidebar - Trends -->
        <aside class="sidebar">
            <div class="trends-card">
                <h2 class="trends-header">
                    <i class="fas fa-fire"></i>
                    Trending at UEW
                </h2>
                <div id="trendsList"></div>
            </div>

            <div class="departments-card">
                <h3 class="departments-header">
                    <i class="fas fa-building"></i>
                    Departments
                </h3>
                <div id="departmentTags"></div>
            </div>
            
            <!-- Star Rating Legend -->
            <div class="trends-card" style="margin-top: 15px;">
                <h3 class="departments-header">
                    <i class="fas fa-star" style="color: #ffd700;"></i>
                    Star Ratings
                </h3>
                <div style="font-size: 13px; color: #65676b; line-height: 1.8;">
                    <div><span class="star-rating-badge stars-2" style="animation: none; margin: 0;"><i class="fas fa-star"></i><i class="fas fa-star"></i><span class="star-rating-label">Rising</span></span> 5+ likes</div>
                    <div style="margin-top: 8px;"><span class="star-rating-badge stars-3" style="animation: none; margin: 0;"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><span class="star-rating-label">Popular</span></span> 10+ likes</div>
                    <div style="margin-top: 8px;"><span class="star-rating-badge stars-4" style="animation: none; margin: 0;"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><span class="star-rating-label">Viral</span></span> 50+ likes</div>
                    <div style="margin-top: 8px;"><span class="star-rating-badge stars-5" style="animation: none; margin: 0;"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><span class="star-rating-label">Legendary</span></span> 100+ likes</div>
                </div>
            </div>
        </aside>

        <!-- Feed Container -->
        <div class="feed-container">
            <div class="feed-header">
                <h1 class="feed-title">Campus Feed</h1>
                <div class="feed-filter">
                    <button class="filter-btn active" data-filter="all">All Posts</button>
                    <button class="filter-btn" data-filter="popular">Popular</button>
                    <button class="filter-btn" data-filter="recent">Recent</button>
                </div>
            </div>
            <div id="postsContainer"></div>
        </div>
    </main>

    <!-- Upload Modal -->
    <div class="modal-overlay" id="uploadModal">
        <div class="modal">
            <div class="modal-header">
                <div></div>
                <h2 class="modal-title">Create Post</h2>
                <button class="modal-close" id="closeUploadModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-user">
                    <div class="user-avatar" id="modalUserAvatar">U</div>
                    <div>
                        <div class="post-username" id="modalUserName">User</div>
                        <div class="post-meta"><i class="fas fa-globe-africa"></i> Public</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Department *</label>
                    <select class="form-select" id="departmentSelect" required>
                        <option value="">Select your department</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="postDescription" placeholder="Write something about your image..." maxlength="2000"></textarea>
                    <div class="char-count"><span id="charCount">0</span>/2000</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Image *</label>
                    <div class="image-upload-area" id="imageUploadArea">
                        <div class="upload-placeholder" id="uploadPlaceholder">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <div class="upload-text">Click to upload image</div>
                            <div class="upload-subtext">JPG, PNG or GIF (Max 10MB)</div>
                        </div>
                        <div class="image-preview-container" id="imagePreviewContainer">
                            <img src="" alt="Preview" class="image-preview" id="imagePreview">
                            <button class="remove-image-btn" id="removeImageBtn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <input type="file" class="hidden-input" id="imageInput" accept="image/*">
                </div>
            </div>
            <div class="modal-footer">
                <button class="post-submit-btn" id="submitPostBtn" disabled>
                    <span id="submitBtnText">Post</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Share Modal -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <div></div>
                <h2 class="modal-title">Share Post</h2>
                <button class="modal-close" id="closeShareModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <div class="share-option" id="shareTimeline">
                        <div class="share-option-icon timeline">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="share-option-text">
                            <h4>Share to Timeline</h4>
                            <p>Post this to your timeline</p>
                        </div>
                    </div>
                    <div class="share-option" id="shareMessage">
                        <div class="share-option-icon message">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <div class="share-option-text">
                            <h4>Send in Message</h4>
                            <p>Share with friends privately</p>
                        </div>
                    </div>
                    <div class="share-option" id="copyLink">
                        <div class="share-option-icon copy">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="share-option-text">
                            <h4>Copy Link</h4>
                            <p>Copy post link to clipboard</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <div></div>
                <h2 class="modal-title">Profile</h2>
                <button class="modal-close" id="closeProfileModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-modal-content">
                    <div class="profile-modal-avatar" id="profileModalAvatar"></div>
                    <div class="profile-modal-name" id="profileModalName"></div>
                    <div class="profile-modal-department" id="profileModalDepartment"></div>
                    <div class="profile-modal-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profilePostsCount">0</div>
                            <div class="profile-stat-label">Posts</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileFollowersCount">0</div>
                            <div class="profile-stat-label">Followers</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profileFollowingCount">0</div>
                            <div class="profile-stat-label">Following</div>
                        </div>
                    </div>
                    <button class="profile-follow-btn" id="profileFollowBtn">Follow</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Star Milestone Notification -->
    <div class="star-milestone" id="starMilestone">
        <div class="star-milestone-stars" id="milestoneStars"></div>
        <div class="star-milestone-text" id="milestoneText"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        // ==================== DATA STORE ====================
        const AppData = {
            currentUser: {
                id: 1,
                name: "Kofi Asante",
                initials: "KA",
                color: "linear-gradient(135deg, #667eea, #764ba2)",
                department: "Computer Science",
                followers: 156,
                following: 89,
                posts: 12,
                followingUsers: []
            },

            users: [
                { id: 2, name: "Ama Serwaa", initials: "AS", color: "#e91e63", department: "Basic Education", followers: 234, following: 123, posts: 45 },
                { id: 3, name: "Kweku Mensah", initials: "KM", color: "#2196f3", department: "Mathematics", followers: 189, following: 98, posts: 23 },
                { id: 4, name: "Efua Owusu", initials: "EO", color: "#9c27b0", department: "Music Education", followers: 312, following: 156, posts: 67 },
                { id: 5, name: "Yaw Boateng", initials: "YB", color: "#ff9800", department: "Physical Education", followers: 145, following: 78, posts: 34 }
            ],

            departments: [
                "Computer Science",
                "Mathematics",
                "Basic Education",
                "Business Administration",
                "Graphic Design",
                "Music Education",
                "Health Education",
                "Social Studies",
                "English Education",
                "Science Education",
                "Physical Education",
                "Special Education"
            ],

            trends: [
                { id: 1, category: "Campus Life", name: "#UEWGraduation2024", posts: 1234 },
                { id: 2, category: "Sports", name: "#InterFacultyGames", posts: 856 },
                { id: 3, category: "Events", name: "#FreshersWeek", posts: 654 },
                { id: 4, category: "Academic", name: "#ExamSeason", posts: 432 }
            ],

            notifications: [],

            posts: [
                {
                    id: "post1",
                    userId: 2,
                    user: { name: "Ama Serwaa", initials: "AS", color: "#e91e63" },
                    department: "Basic Education",
                    time: "2 hours ago",
                    timestamp: Date.now() - 7200000,
                    content: "Just finished my teaching practice presentation!  It was such an amazing experience working with the kids at the demonstration school. Can't wait to become a full-time educator! #TeachingPractice #UEW #Education",
                    image: null,
                    imageType: "teaching",
                    likes: 234,
                    likedBy: [],
                    comments: [
                        {
                            id: "c1",
                            userId: 3,
                            user: { name: "Kweku Mensah", initials: "KM", color: "#2196f3" },
                            text: "Congratulations! You're going to be an amazing teacher! ",
                            likes: 12,
                            likedBy: [],
                            time: "1 hour ago",
                            timestamp: Date.now() - 3600000,
                            replies: []
                        }
                    ],
                    shares: 23,
                    showComments: false,
                    visibleComments: 2,
                    isExpanded: false
                },
                {
                    id: "post2",
                    userId: 4,
                    user: { name: "Efua Owusu", initials: "EO", color: "#9c27b0" },
                    department: "Music Education",
                    time: "5 hours ago",
                    timestamp: Date.now() - 18000000,
                    content: "Our choir just won first place at the inter-university competition!  So proud of everyone who worked so hard for this moment. Music truly brings us together!",
                    image: null,
                    imageType: "music",
                    likes: 456,
                    likedBy: [],
                    comments: [],
                    shares: 67,
                    showComments: false,
                    visibleComments: 2,
                    isExpanded: false
                },
                {
                    id: "post3",
                    userId: 3,
                    user: { name: "Kweku Mensah", initials: "KM", color: "#2196f3" },
                    department: "Mathematics",
                    time: "1 day ago",
                    timestamp: Date.now() - 86400000,
                    content: "Solved a complex calculus problem today! Math is beautiful when you understand it. ",
                    image: null,
                    imageType: "project",
                    likes: 45,
                    likedBy: [],
                    comments: [],
                    shares: 5,
                    showComments: false,
                    visibleComments: 2,
                    isExpanded: false
                },
                {
                    id: "post4",
                    userId: 5,
                    user: { name: "Yaw Boateng", initials: "YB", color: "#ff9800" },
                    department: "Physical Education",
                    time: "3 days ago",
                    timestamp: Date.now() - 259200000,
                    content: "Great training session with the athletics team! Getting ready for the inter-faculty games. ",
                    image: null,
                    imageType: "sports",
                    likes: 3,
                    likedBy: [],
                    comments: [],
                    shares: 2,
                    showComments: false,
                    visibleComments: 2,
                    isExpanded: false
                }
            ],

            activeFilter: "all",
            activeDepartment: null,
            selectedImage: null,
            currentSharePostId: null,
            currentProfileUserId: null
        };

        // ==================== UTILITY FUNCTIONS ====================
        function generateId() {
            return 'post_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return "Just now";
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} min${minutes > 1 ? 's' : ''} ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            const days = Math.floor(hours / 24);
            if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;
            return new Date(timestamp).toLocaleDateString();
        }

        function getImagePlaceholder(type) {
            const icons = {
                project: "fa-laptop-code",
                music: "fa-music",
                teaching: "fa-chalkboard-teacher",
                sports: "fa-futbol",
                graduation: "fa-graduation-cap",
                event: "fa-calendar-alt",
                default: "fa-image"
            };
            return icons[type] || icons.default;
        }

        function showToast(message, type = "success") {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            icon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function isFollowing(userId) {
            return AppData.currentUser.followingUsers.includes(userId);
        }

        function getUserById(userId) {
            if (userId === AppData.currentUser.id) return AppData.currentUser;
            return AppData.users.find(u => u.id === userId);
        }

        function shouldShowSeeMore(text) {
            if (!text) return false;
            const lines = text.split('\n');
            return lines.length > 5 || text.length > 300;
        }

        function getCollapsedContent(text) {
            if (!text) return '';
            const lines = text.split('\n');
            if (lines.length > 5) {
                return lines.slice(0, 5).join('\n');
            }
            if (text.length > 300) {
                return text.substring(0, 300);
            }
            return text;
        }

        function getInitials(name) {
            if (!name) return "U";
            const parts = name.trim().split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        // ==================== STAR RATING FUNCTIONS ====================
        function getStarRating(likes) {
            // Returns the number of stars based on likes
            // 5-9 likes = 2 stars (Rising)
            // 10-49 likes = 3 stars (Popular)
            // 50-99 likes = 4 stars (Viral)
            // 100+ likes = 5 stars (Legendary)
            // Less than 5 likes = no stars
            
            if (likes >= 100) return 5;
            if (likes >= 50) return 4;
            if (likes >= 10) return 3;
            if (likes >= 5) return 2;
            return 0;
        }

        function getStarLabel(stars) {
            switch(stars) {
                case 5: return 'Legendary';
                case 4: return 'Viral';
                case 3: return 'Popular';
                case 2: return 'Rising';
                default: return '';
            }
        }

        function renderStarBadge(likes) {
            const stars = getStarRating(likes);
            if (stars === 0) return '';
            
            let starsHTML = '';
            for (let i = 0; i < stars; i++) {
                starsHTML += '<i class="fas fa-star"></i>';
            }
            
            const label = getStarLabel(stars);
            
            return `
                <span class="star-rating-badge stars-${stars}" title="${likes} likes - ${label}">
                    ${starsHTML}
                    <span class="star-rating-label">${label}</span>
                </span>
            `;
        }

        function showStarMilestone(stars, label) {
            const milestone = document.getElementById('starMilestone');
            const starsContainer = document.getElementById('milestoneStars');
            const textContainer = document.getElementById('milestoneText');
            
            let starsHTML = '';
            for (let i = 0; i < stars; i++) {
                starsHTML += '';
            }
            
            starsContainer.textContent = starsHTML;
            textContainer.textContent = `Post earned ${label} status!`;
            
            milestone.classList.add('show');
            
            setTimeout(() => {
                milestone.classList.remove('show');
            }, 2500);
        }

        // ==================== NOTIFICATION FUNCTIONS ====================
        function addNotification(type, fromUser, postId = null, content = "") {
            const notification = {
                id: generateId(),
                type: type,
                fromUserId: fromUser.id,
                fromUser: fromUser,
                postId: postId,
                content: content,
                timestamp: Date.now(),
                read: false
            };
            
            AppData.notifications.unshift(notification);
            updateNotificationBadge();
            renderNotifications();
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const unreadCount = AppData.notifications.filter(n => !n.read).length;
            
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            badge.classList.toggle('hidden', unreadCount === 0);
        }

        function markNotificationAsRead(notificationId) {
            const notification = AppData.notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotificationBadge();
                renderNotifications();
            }
        }

        function markAllNotificationsAsRead() {
            AppData.notifications.forEach(n => n.read = true);
            updateNotificationBadge();
            renderNotifications();
            showToast("All notifications marked as read!");
        }

        function getNotificationText(notification) {
            switch (notification.type) {
                case 'like':
                    return `<strong>${notification.fromUser.name}</strong> liked your post`;
                case 'comment':
                    return `<strong>${notification.fromUser.name}</strong> commented on your post: "${notification.content.substring(0, 50)}${notification.content.length > 50 ? '...' : ''}"`;
                case 'follow':
                    return `<strong>${notification.fromUser.name}</strong> started following you`;
                case 'share':
                    return `<strong>${notification.fromUser.name}</strong> shared your post`;
                default:
                    return `<strong>${notification.fromUser.name}</strong> interacted with your post`;
            }
        }

        function getNotificationIconClass(type) {
            switch (type) {
                case 'like': return 'like';
                case 'comment': return 'comment';
                case 'follow': return 'follow';
                case 'share': return 'share';
                default: return 'like';
            }
        }

        function getNotificationIcon(type) {
            switch (type) {
                case 'like': return 'fa-thumbs-up';
                case 'comment': return 'fa-comment';
                case 'follow': return 'fa-user-plus';
                case 'share': return 'fa-share';
                default: return 'fa-bell';
            }
        }

        function renderNotifications() {
            const container = document.getElementById('notificationList');
            
            if (AppData.notifications.length === 0) {
                container.innerHTML = `
                    <div class="no-notifications">
                        <i class="fas fa-bell-slash"></i>
                        <p>No notifications yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = AppData.notifications.map(notification => `
                <div class="notification-item ${notification.read ? '' : 'unread'}" data-notification-id="${notification.id}">
                    <div class="notification-avatar" style="background: ${notification.fromUser.color}">
                        ${notification.fromUser.initials}
                        <span class="notification-icon-badge ${getNotificationIconClass(notification.type)}">
                            <i class="fas ${getNotificationIcon(notification.type)}"></i>
                        </span>
                    </div>
                    <div class="notification-content">
                        <div class="notification-text">${getNotificationText(notification)}</div>
                        <div class="notification-time">${formatTimeAgo(notification.timestamp)}</div>
                    </div>
                    ${!notification.read ? '<div class="notification-unread-dot"></div>' : ''}
                </div>
            `).join('');

            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', () => {
                    const notificationId = item.dataset.notificationId;
                    markNotificationAsRead(notificationId);
                    
                    const notification = AppData.notifications.find(n => n.id === notificationId);
                    if (notification) {
                        if (notification.type === 'follow') {
                            handleOpenProfile(notification.fromUserId);
                        } else if (notification.postId) {
                            const postElement = document.querySelector(`[data-post-id="${notification.postId}"]`);
                            if (postElement) {
                                postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                postElement.style.boxShadow = '0 0 0 3px #1877f2';
                                setTimeout(() => {
                                    postElement.style.boxShadow = '';
                                }, 2000);
                            }
                        }
                    }
                    
                    document.getElementById('notificationDropdown').classList.remove('show');
                });
            });
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderTrends() {
            const container = document.getElementById('trendsList');
            
            if (AppData.trends.length === 0) {
                container.innerHTML = '<div class="no-trends">No trending topics yet</div>';
                return;
            }
            
            container.innerHTML = AppData.trends.map(trend => `
                <div class="trend-item" data-trend-id="${trend.id}">
                    <div class="trend-category">${trend.category}</div>
                    <div class="trend-name">${trend.name}</div>
                    <div class="trend-posts">${trend.posts.toLocaleString()} posts</div>
                </div>
            `).join('');

            attachTrendListeners();
        }

        function renderDepartments() {
            const container = document.getElementById('departmentTags');
            const select = document.getElementById('departmentSelect');

            container.innerHTML = AppData.departments.slice(0, 8).map(dept => `
                <span class="department-tag ${AppData.activeDepartment === dept ? 'active' : ''}" data-department="${dept}">
                    ${dept}
                </span>
            `).join('');

            select.innerHTML = '<option value="">Select your department</option>' +
                AppData.departments.map(dept => `<option value="${dept}">${dept}</option>`).join('');

            attachDepartmentListeners();
        }

        function renderPost(post) {
            const isLiked = post.likedBy.includes(AppData.currentUser.id);
            const isFollowingUser = isFollowing(post.userId);
            const isOwnPost = post.userId === AppData.currentUser.id;
            const showSeeMore = shouldShowSeeMore(post.content);
            const isExpanded = post.isExpanded || false;
            
            let displayContent = post.content || '';
            if (showSeeMore && !isExpanded) {
                displayContent = getCollapsedContent(post.content);
            }
            
            const sortedComments = [...post.comments].sort((a, b) => b.timestamp - a.timestamp);
            const visibleComments = sortedComments.slice(0, post.visibleComments || 2);
            const hasMoreComments = sortedComments.length > visibleComments.length;
            
            // Get star rating HTML
            const starBadgeHTML = renderStarBadge(post.likes);
            
            const commentsHTML = visibleComments.map(comment => {
                const isCommentLiked = comment.likedBy.includes(AppData.currentUser.id);
                const isFollowingCommenter = isFollowing(comment.userId);
                const isOwnComment = comment.userId === AppData.currentUser.id;
                
                const repliesHTML = comment.replies.map(reply => `
                    <div class="reply">
                        <div class="reply-avatar" style="background: ${reply.user.color}">${reply.user.initials}</div>
                        <div class="comment-content">
                            <div class="comment-username">${reply.user.name}</div>
                            <div class="comment-text">${reply.text}</div>
                        </div>
                    </div>
                `).join('');

                return `
                    <div class="comment" data-comment-id="${comment.id}">
                        <div class="comment-avatar" style="background: ${comment.user.color}" 
                             data-user-id="${comment.userId}">${comment.user.initials}</div>
                        <div class="comment-body">
                            <div class="comment-content">
                                <div class="comment-header">
                                    <span class="comment-username" data-user-id="${comment.userId}">${comment.user.name}</span>
                                    ${!isOwnComment ? `
                                        <button class="comment-follow-btn ${isFollowingCommenter ? 'following' : ''}" 
                                                data-user-id="${comment.userId}">
                                            ${isFollowingCommenter ? 'Following' : 'Follow'}
                                        </button>
                                    ` : ''}
                                </div>
                                <div class="comment-text">${comment.text}</div>
                            </div>
                            <div class="comment-actions">
                                <span class="comment-action like-comment-btn ${isCommentLiked ? 'liked' : ''}" 
                                      data-post-id="${post.id}" data-comment-id="${comment.id}">
                                    ${isCommentLiked ? 'Liked' : 'Like'}
                                </span>
                                <span class="comment-action reply-toggle-btn" 
                                      data-post-id="${post.id}" data-comment-id="${comment.id}">Reply</span>
                                <span class="comment-action">${comment.likes} likes</span>
                                <span class="comment-action">${comment.time}</span>
                            </div>
                            <div class="reply-input-container" id="reply-${post.id}-${comment.id}">
                                <div class="reply-avatar" style="background: ${AppData.currentUser.color}">${AppData.currentUser.initials}</div>
                                <div class="reply-input-wrapper">
                                    <input type="text" class="reply-input" placeholder="Write a reply..." 
                                           data-post-id="${post.id}" data-comment-id="${comment.id}">
                                    <button class="comment-submit reply-submit-btn" 
                                            data-post-id="${post.id}" data-comment-id="${comment.id}">
                                        <i class="fas fa-paper-plane"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="replies-container">${repliesHTML}</div>
                        </div>
                    </div>
                `;
            }).join('');

            // Image content - show actual image if uploaded, otherwise show placeholder
            let imageContent;
            if (post.image) {
                imageContent = `<img src="${post.image}" alt="Post image" class="post-image">`;
            } else {
                imageContent = `
                    <div class="post-image-placeholder">
                        <i class="fas ${getImagePlaceholder(post.imageType)}"></i>
                        <span>Image from ${post.department}</span>
                    </div>
                `;
            }

            // Follow button HTML - only show for posts that are NOT from current user
            let followButtonHTML = '';
            if (!isOwnPost) {
                followButtonHTML = `
                    <button class="follow-btn ${isFollowingUser ? 'following' : ''}" 
                            data-user-id="${post.userId}">
                        ${isFollowingUser ? 'Following' : 'Follow'}
                    </button>
                `;
            } else {
                followButtonHTML = `<span class="own-post-badge">Your Post</span>`;
            }

            return `
                <article class="post-card" data-post-id="${post.id}">
                    <div class="post-header">
                        <div class="post-avatar" style="background: ${post.user.color}" 
                             data-user-id="${post.userId}">${post.user.initials}</div>
                        <div class="post-user-info">
                            <div class="post-username-container">
                                <span class="post-username" data-user-id="${post.userId}">${post.user.name}</span>
                                ${followButtonHTML}
                                ${starBadgeHTML}
                            </div>
                            <div class="post-meta">
                                <span>${post.time}</span>
                                <span></span>
                                <span class="post-department">${post.department}</span>
                                <span></span>
                                <i class="fas fa-globe-africa"></i>
                            </div>
                            <!-- Test buttons for demo - click to add likes -->
                            <div class="like-test-container">
                                <button class="like-test-btn" data-post-id="${post.id}" data-amount="1">+1</button>
                                <button class="like-test-btn" data-post-id="${post.id}" data-amount="5">+5</button>
                                <button class="like-test-btn" data-post-id="${post.id}" data-amount="10">+10</button>
                                <button class="like-test-btn" data-post-id="${post.id}" data-amount="50">+50</button>
                                <button class="like-test-btn" data-post-id="${post.id}" data-amount="-10">-10</button>
                            </div>
                        </div>
                        <div class="post-options" data-post-id="${post.id}">
                            <i class="fas fa-ellipsis-h"></i>
                            <div class="options-dropdown" id="options-${post.id}">
                                <div class="option-item save-post-btn" data-post-id="${post.id}">
                                    <i class="fas fa-bookmark"></i>
                                    <span>Save Post</span>
                                </div>
                                <div class="option-item hide-post-btn" data-post-id="${post.id}">
                                    <i class="fas fa-eye-slash"></i>
                                    <span>Hide Post</span>
                                </div>
                                ${isOwnPost ? `
                                    <div class="option-item delete delete-post-btn" data-post-id="${post.id}">
                                        <i class="fas fa-trash"></i>
                                        <span>Delete Post</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-content-text ${showSeeMore && !isExpanded ? 'collapsed' : ''}" id="content-${post.id}">${displayContent}</div>
                        ${showSeeMore ? `
                            <button class="see-more-btn" data-post-id="${post.id}">
                                ${isExpanded ? 'See less' : 'See more'}
                            </button>
                        ` : ''}
                    </div>
                    <div class="post-image-container">${imageContent}</div>
                    <div class="post-stats">
                        <div class="like-icons">
                            <span class="like-icon like"><i class="fas fa-thumbs-up"></i></span>
                            <span class="like-icon love"><i class="fas fa-heart"></i></span>
                            <span>${post.likes.toLocaleString()} likes</span>
                        </div>
                        <div>
                            <span>${post.comments.length} comments</span>
                            <span>  </span>
                            <span>${post.shares} shares</span>
                        </div>
                    </div>
                    <div class="post-actions">
                        <button class="action-btn like-post-btn ${isLiked ? 'liked' : ''}" data-post-id="${post.id}">
                            <i class="fa${isLiked ? 's' : 'r'} fa-thumbs-up"></i>
                            <span>${isLiked ? 'Liked' : 'Like'}</span>
                        </button>
                        <button class="action-btn comment-toggle-btn" data-post-id="${post.id}">
                            <i class="far fa-comment"></i>
                            <span>Comment</span>
                        </button>
                        <button class="action-btn share-post-btn" data-post-id="${post.id}">
                            <i class="far fa-share-square"></i>
                            <span>Share</span>
                        </button>
                    </div>
                    <div class="comments-section ${post.showComments ? 'show' : ''}" id="comments-section-${post.id}">
                        <div class="comment-input-container">
                            <div class="comment-avatar" style="background: ${AppData.currentUser.color}">${AppData.currentUser.initials}</div>
                            <div class="comment-input-wrapper">
                                <input type="text" class="comment-input" placeholder="Write a comment..." data-post-id="${post.id}">
                                <button class="comment-submit comment-submit-btn" data-post-id="${post.id}" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        ${post.comments.length > 0 ? `
                            <div class="comments-count-header">
                                <span class="comments-count">${post.comments.length} Comment${post.comments.length !== 1 ? 's' : ''}</span>
                                <span class="comments-sort">
                                    <i class="fas fa-sort-amount-down"></i> Newest first
                                </span>
                            </div>
                        ` : ''}
                        <div class="comments-list">${commentsHTML}</div>
                        ${hasMoreComments ? `
                            <div class="view-more-comments" data-post-id="${post.id}">
                                View ${sortedComments.length - visibleComments.length} more comment${sortedComments.length - visibleComments.length !== 1 ? 's' : ''}
                            </div>
                        ` : ''}
                    </div>
                </article>
            `;
        }

        function renderPosts() {
            const container = document.getElementById('postsContainer');
            let filteredPosts = [...AppData.posts];

            if (AppData.activeDepartment) {
                filteredPosts = filteredPosts.filter(p => p.department === AppData.activeDepartment);
            }

            switch (AppData.activeFilter) {
                case 'popular':
                    filteredPosts.sort((a, b) => b.likes - a.likes);
                    break;
                case 'recent':
                    filteredPosts.sort((a, b) => b.timestamp - a.timestamp);
                    break;
            }

            if (filteredPosts.length === 0) {
                container.innerHTML = `
                    <div class="no-posts">
                        <i class="fas fa-image"></i>
                        <h3>No Posts Yet</h3>
                        <p>Be the first to share something with the campus!</p>
                    </div>
                `;
            } else {
                container.innerHTML = filteredPosts.map(post => renderPost(post)).join('');
            }

            attachPostListeners();
        }

        // ==================== EVENT HANDLERS ====================
        function handleLikePost(postId) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            const prevStars = getStarRating(post.likes);
            
            const userIndex = post.likedBy.indexOf(AppData.currentUser.id);
            if (userIndex === -1) {
                post.likedBy.push(AppData.currentUser.id);
                post.likes++;
                
                if (post.userId !== AppData.currentUser.id) {
                    addNotification('like', AppData.currentUser, postId);
                }
            } else {
                post.likedBy.splice(userIndex, 1);
                post.likes--;
            }
            
            // Check if post earned new star rating
            const newStars = getStarRating(post.likes);
            if (newStars > prevStars && newStars >= 2) {
                const label = getStarLabel(newStars);
                showStarMilestone(newStars, label);
            }
            
            renderPosts();
        }

        // Add likes for testing star ratings
        function handleAddLikes(postId, amount) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            const prevStars = getStarRating(post.likes);
            
            post.likes = Math.max(0, post.likes + amount);
            
            // Check if post earned new star rating
            const newStars = getStarRating(post.likes);
            if (newStars > prevStars && newStars >= 2) {
                const label = getStarLabel(newStars);
                showStarMilestone(newStars, label);
            }
            
            renderPosts();
        }

        function handleToggleComments(postId) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            post.showComments = !post.showComments;
            renderPosts();

            if (post.showComments) {
                setTimeout(() => {
                    const input = document.querySelector(`#comments-section-${postId} .comment-input`);
                    if (input) input.focus();
                }, 100);
            }
        }

        function handleSubmitComment(postId, text) {
            if (!text.trim()) return;

            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            const newComment = {
                id: generateId(),
                userId: AppData.currentUser.id,
                user: {
                    name: AppData.currentUser.name,
                    initials: AppData.currentUser.initials,
                    color: "#667eea"
                },
                text: text.trim(),
                likes: 0,
                likedBy: [],
                time: "Just now",
                timestamp: Date.now(),
                replies: []
            };

            post.comments.push(newComment);
            post.showComments = true;
            
            if (post.userId !== AppData.currentUser.id) {
                addNotification('comment', AppData.currentUser, postId, text.trim());
            }
            
            renderPosts();
            showToast("Comment added!");
        }

        function handleLikeComment(postId, commentId) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            const comment = post.comments.find(c => c.id === commentId);
            if (!comment) return;

            const userIndex = comment.likedBy.indexOf(AppData.currentUser.id);
            if (userIndex === -1) {
                comment.likedBy.push(AppData.currentUser.id);
                comment.likes++;
            } else {
                comment.likedBy.splice(userIndex, 1);
                comment.likes--;
            }
            renderPosts();
        }

        function handleToggleReply(postId, commentId) {
            const container = document.getElementById(`reply-${postId}-${commentId}`);
            if (container) {
                container.classList.toggle('show');
                if (container.classList.contains('show')) {
                    container.querySelector('.reply-input').focus();
                }
            }
        }

        function handleSubmitReply(postId, commentId, text) {
            if (!text.trim()) return;

            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            const comment = post.comments.find(c => c.id === commentId);
            if (!comment) return;

            const newReply = {
                id: generateId(),
                userId: AppData.currentUser.id,
                user: {
                    name: AppData.currentUser.name,
                    initials: AppData.currentUser.initials,
                    color: "#667eea"
                },
                text: text.trim(),
                time: "Just now"
            };

            comment.replies.push(newReply);
            renderPosts();
            showToast("Reply added!");
        }

        function handleSharePost(postId) {
            AppData.currentSharePostId = postId;
            document.getElementById('shareModal').classList.add('show');
        }

        function handleShareAction(type) {
            const post = AppData.posts.find(p => p.id === AppData.currentSharePostId);
            if (!post) return;

            switch (type) {
                case 'timeline':
                    post.shares++;
                    if (post.userId !== AppData.currentUser.id) {
                        addNotification('share', AppData.currentUser, post.id);
                    }
                    showToast("Shared to your timeline!");
                    break;
                case 'message':
                    showToast("Share link copied! Send it to a friend.");
                    break;
                case 'copy':
                    navigator.clipboard.writeText(`https://campustrend.uew.edu.gh/post/${post.id}`);
                    showToast("Link copied to clipboard!");
                    break;
            }

            document.getElementById('shareModal').classList.remove('show');
            renderPosts();
        }

        function handleDeletePost(postId) {
            if (confirm("Are you sure you want to delete this post?")) {
                const index = AppData.posts.findIndex(p => p.id === postId);
                if (index !== -1) {
                    AppData.posts.splice(index, 1);
                    renderPosts();
                    showToast("Post deleted!");
                }
            }
        }

        function handleSavePost(postId) {
            showToast("Post saved to your collection!");
            closeAllDropdowns();
        }

        function handleHidePost(postId) {
            const index = AppData.posts.findIndex(p => p.id === postId);
            if (index !== -1) {
                AppData.posts.splice(index, 1);
                renderPosts();
                showToast("Post hidden from your feed.");
            }
        }

        function handleFilterChange(filter) {
            AppData.activeFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            renderPosts();
        }

        function handleDepartmentFilter(department) {
            if (AppData.activeDepartment === department) {
                AppData.activeDepartment = null;
            } else {
                AppData.activeDepartment = department;
            }
            renderDepartments();
            renderPosts();
        }

        function handleTrendClick(trendId) {
            const trend = AppData.trends.find(t => t.id === trendId);
            if (trend) {
                showToast(`Viewing ${trend.name}`);
            }
        }

        function handleFollow(userId) {
            const userIndex = AppData.currentUser.followingUsers.indexOf(userId);
            const user = getUserById(userId);
            
            if (userIndex === -1) {
                AppData.currentUser.followingUsers.push(userId);
                AppData.currentUser.following++;
                if (user && user.followers !== undefined) user.followers++;
                
                if (user) {
                    addNotification('follow', AppData.currentUser, null);
                }
                
                showToast(`You are now following ${user ? user.name : 'this user'}!`);
            } else {
                AppData.currentUser.followingUsers.splice(userIndex, 1);
                AppData.currentUser.following--;
                if (user && user.followers !== undefined) user.followers--;
                showToast(`You unfollowed ${user ? user.name : 'this user'}.`);
            }
            renderPosts();
        }

        function handleSeeMore(postId) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            post.isExpanded = !post.isExpanded;
            renderPosts();
        }

        function handleViewMoreComments(postId) {
            const post = AppData.posts.find(p => p.id === postId);
            if (!post) return;

            post.visibleComments = (post.visibleComments || 2) + 5;
            renderPosts();
        }

        function handleOpenProfile(userId) {
            const user = getUserById(userId);
            if (!user) return;

            AppData.currentProfileUserId = userId;
            
            const userPosts = AppData.posts.filter(p => p.userId === userId);
            const isFollowingUser = isFollowing(userId);
            const isOwnProfile = userId === AppData.currentUser.id;

            document.getElementById('profileModalAvatar').style.background = user.color || 'linear-gradient(135deg, #667eea, #764ba2)';
            document.getElementById('profileModalAvatar').textContent = user.initials;
            document.getElementById('profileModalName').textContent = user.name;
            document.getElementById('profileModalDepartment').textContent = user.department || 'UEW Student';
            document.getElementById('profilePostsCount').textContent = user.posts || userPosts.length;
            document.getElementById('profileFollowersCount').textContent = user.followers || 0;
            document.getElementById('profileFollowingCount').textContent = user.following || 0;

            const followBtn = document.getElementById('profileFollowBtn');
            if (isOwnProfile) {
                followBtn.style.display = 'none';
            } else {
                followBtn.style.display = 'inline-block';
                followBtn.textContent = isFollowingUser ? 'Following' : 'Follow';
                followBtn.className = `profile-follow-btn ${isFollowingUser ? 'following' : ''}`;
            }

            document.getElementById('profileModal').classList.add('show');
        }

        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showToast("Please select an image file.", "error");
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showToast("Image size should be less than 10MB.", "error");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                AppData.selectedImage = e.target.result;
                displayImagePreview(e.target.result);
                updateSubmitButton();
            };
            reader.readAsDataURL(file);
        }

        function displayImagePreview(src) {
            const uploadArea = document.getElementById('imageUploadArea');
            const placeholder = document.getElementById('uploadPlaceholder');
            const previewContainer = document.getElementById('imagePreviewContainer');
            const preview = document.getElementById('imagePreview');

            preview.src = src;
            placeholder.style.display = 'none';
            previewContainer.style.display = 'block';
            uploadArea.classList.add('has-image');
        }

        function removeImagePreview() {
            const uploadArea = document.getElementById('imageUploadArea');
            const placeholder = document.getElementById('uploadPlaceholder');
            const previewContainer = document.getElementById('imagePreviewContainer');
            const imageInput = document.getElementById('imageInput');

            AppData.selectedImage = null;
            imageInput.value = '';
            placeholder.style.display = 'block';
            previewContainer.style.display = 'none';
            uploadArea.classList.remove('has-image');
            updateSubmitButton();
        }

        function updateSubmitButton() {
            const department = document.getElementById('departmentSelect').value;
            const submitBtn = document.getElementById('submitPostBtn');
            submitBtn.disabled = !AppData.selectedImage || !department;
        }

        function updateCharCount() {
            const textarea = document.getElementById('postDescription');
            const charCount = document.getElementById('charCount');
            charCount.textContent = textarea.value.length;
        }

        function handleSubmitPost() {
            const department = document.getElementById('departmentSelect').value;
            const description = document.getElementById('postDescription').value;

            if (!AppData.selectedImage) {
                showToast("Please select an image.", "error");
                return;
            }

            if (!department) {
                showToast("Please select your department.", "error");
                return;
            }

            // Create new post with the current user's ID
            const newPost = {
                id: generateId(),
                userId: AppData.currentUser.id,
                user: {
                    name: AppData.currentUser.name,
                    initials: AppData.currentUser.initials,
                    color: "#667eea"
                },
                department: department,
                time: "Just now",
                timestamp: Date.now(),
                content: description || `Shared a photo from ${department}`,
                image: AppData.selectedImage,
                imageType: "default",
                likes: 0,
                likedBy: [],
                comments: [],
                shares: 0,
                showComments: false,
                visibleComments: 2,
                isExpanded: false
            };

            AppData.posts.unshift(newPost);
            AppData.currentUser.posts++;
            
            closeUploadModal();
            renderPosts();
            showToast("Post published successfully!");
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.options-dropdown.show').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        // ==================== MODAL FUNCTIONS ====================
        function openUploadModal() {
            document.getElementById('uploadModal').classList.add('show');
            document.getElementById('modalUserAvatar').textContent = AppData.currentUser.initials;
            document.getElementById('modalUserName').textContent = AppData.currentUser.name;
            document.getElementById('charCount').textContent = '0';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('show');
            document.getElementById('departmentSelect').value = '';
            document.getElementById('postDescription').value = '';
            document.getElementById('charCount').textContent = '0';
            removeImagePreview();
        }

        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('show');
            AppData.currentSharePostId = null;
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('show');
            AppData.currentProfileUserId = null;
        }

        // ==================== EVENT LISTENERS ====================
        function attachTrendListeners() {
            document.querySelectorAll('.trend-item').forEach(item => {
                item.addEventListener('click', () => {
                    handleTrendClick(parseInt(item.dataset.trendId));
                });
            });
        }

        function attachDepartmentListeners() {
            document.querySelectorAll('.department-tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    handleDepartmentFilter(tag.dataset.department);
                });
            });
        }

        function attachPostListeners() {
            // Like post buttons
            document.querySelectorAll('.like-post-btn').forEach(btn => {
                btn.addEventListener('click', () => handleLikePost(btn.dataset.postId));
            });

            // Like test buttons (for demo)
            document.querySelectorAll('.like-test-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const amount = parseInt(btn.dataset.amount);
                    handleAddLikes(btn.dataset.postId, amount);
                });
            });

            // Comment toggle buttons
            document.querySelectorAll('.comment-toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => handleToggleComments(btn.dataset.postId));
            });

            // Share buttons
            document.querySelectorAll('.share-post-btn').forEach(btn => {
                btn.addEventListener('click', () => handleSharePost(btn.dataset.postId));
            });

            // See more buttons
            document.querySelectorAll('.see-more-btn').forEach(btn => {
                btn.addEventListener('click', () => handleSeeMore(btn.dataset.postId));
            });

            // View more comments
            document.querySelectorAll('.view-more-comments').forEach(btn => {
                btn.addEventListener('click', () => handleViewMoreComments(btn.dataset.postId));
            });

            // Follow buttons (post header)
            document.querySelectorAll('.follow-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleFollow(parseInt(btn.dataset.userId));
                });
            });

            // Follow buttons (comments)
            document.querySelectorAll('.comment-follow-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleFollow(parseInt(btn.dataset.userId));
                });
            });

            // Username clicks (open profile)
            document.querySelectorAll('.post-username, .post-avatar, .comment-username').forEach(el => {
                el.addEventListener('click', () => {
                    const userId = parseInt(el.dataset.userId);
                    if (userId) handleOpenProfile(userId);
                });
            });

            // Comment avatar clicks
            document.querySelectorAll('.comment-avatar[data-user-id]').forEach(el => {
                el.addEventListener('click', () => {
                    const userId = parseInt(el.dataset.userId);
                    if (userId) handleOpenProfile(userId);
                });
            });

            // Comment inputs
            document.querySelectorAll('.comment-input').forEach(input => {
                const submitBtn = input.parentElement.querySelector('.comment-submit-btn');
                
                input.addEventListener('input', () => {
                    submitBtn.disabled = !input.value.trim();
                });

                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && input.value.trim()) {
                        handleSubmitComment(input.dataset.postId, input.value);
                        input.value = '';
                        submitBtn.disabled = true;
                    }
                });
            });

            // Comment submit buttons
            document.querySelectorAll('.comment-submit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const input = btn.parentElement.querySelector('.comment-input');
                    if (input && input.value.trim()) {
                        handleSubmitComment(btn.dataset.postId, input.value);
                        input.value = '';
                        btn.disabled = true;
                    }
                });
            });

            // Like comment buttons
            document.querySelectorAll('.like-comment-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    handleLikeComment(btn.dataset.postId, btn.dataset.commentId);
                });
            });

            // Reply toggle buttons
            document.querySelectorAll('.reply-toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    handleToggleReply(btn.dataset.postId, btn.dataset.commentId);
                });
            });

            // Reply inputs
            document.querySelectorAll('.reply-input').forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && input.value.trim()) {
                        handleSubmitReply(input.dataset.postId, input.dataset.commentId, input.value);
                        input.value = '';
                    }
                });
            });

            // Reply submit buttons
            document.querySelectorAll('.reply-submit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const input = btn.parentElement.querySelector('.reply-input');
                    if (input && input.value.trim()) {
                        handleSubmitReply(btn.dataset.postId, btn.dataset.commentId, input.value);
                        input.value = '';
                    }
                });
            });

            // Post options buttons
            document.querySelectorAll('.post-options').forEach(optionsBtn => {
                optionsBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const dropdown = document.getElementById(`options-${optionsBtn.dataset.postId}`);
                    const wasOpen = dropdown.classList.contains('show');
                    closeAllDropdowns();
                    if (!wasOpen) {
                        dropdown.classList.add('show');
                    }
                });
            });

            // Delete post buttons
            document.querySelectorAll('.delete-post-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleDeletePost(btn.dataset.postId);
                });
            });

            // Save post buttons
            document.querySelectorAll('.save-post-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleSavePost(btn.dataset.postId);
                });
            });

            // Hide post buttons
            document.querySelectorAll('.hide-post-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    handleHidePost(btn.dataset.postId);
                });
            });
        }

        function attachGlobalListeners() {
            // Upload modal
            document.getElementById('openUploadModal').addEventListener('click', openUploadModal);
            document.getElementById('closeUploadModal').addEventListener('click', closeUploadModal);
            document.getElementById('uploadModal').addEventListener('click', (e) => {
                if (e.target.id === 'uploadModal') closeUploadModal();
            });

            // Share modal
            document.getElementById('closeShareModal').addEventListener('click', closeShareModal);
            document.getElementById('shareModal').addEventListener('click', (e) => {
                if (e.target.id === 'shareModal') closeShareModal();
            });
            document.getElementById('shareTimeline').addEventListener('click', () => handleShareAction('timeline'));
            document.getElementById('shareMessage').addEventListener('click', () => handleShareAction('message'));
            document.getElementById('copyLink').addEventListener('click', () => handleShareAction('copy'));

            // Profile modal
            document.getElementById('closeProfileModal').addEventListener('click', closeProfileModal);
            document.getElementById('profileModal').addEventListener('click', (e) => {
                if (e.target.id === 'profileModal') closeProfileModal();
            });
            document.getElementById('profileFollowBtn').addEventListener('click', () => {
                if (AppData.currentProfileUserId) {
                    handleFollow(AppData.currentProfileUserId);
                    const isFollowingUser = isFollowing(AppData.currentProfileUserId);
                    const followBtn = document.getElementById('profileFollowBtn');
                    followBtn.textContent = isFollowingUser ? 'Following' : 'Follow';
                    followBtn.className = `profile-follow-btn ${isFollowingUser ? 'following' : ''}`;
                    
                    const user = getUserById(AppData.currentProfileUserId);
                    if (user) {
                        document.getElementById('profileFollowersCount').textContent = user.followers || 0;
                    }
                }
            });

            // Notification bell
            document.getElementById('notificationBell').addEventListener('click', (e) => {
                e.stopPropagation();
                const dropdown = document.getElementById('notificationDropdown');
                dropdown.classList.toggle('show');
            });

            // Mark all notifications as read
            document.getElementById('markAllRead').addEventListener('click', (e) => {
                e.stopPropagation();
                markAllNotificationsAsRead();
            });

            // Close notification dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('notificationDropdown');
                const bell = document.getElementById('notificationBell');
                if (!bell.contains(e.target)) {
                    dropdown.classList.remove('show');
                }
            });

            // Image upload
            document.getElementById('imageUploadArea').addEventListener('click', () => {
                document.getElementById('imageInput').click();
            });
            document.getElementById('imageInput').addEventListener('change', handleImageSelect);
            document.getElementById('removeImageBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                removeImagePreview();
            });

            // Form validation
            document.getElementById('departmentSelect').addEventListener('change', updateSubmitButton);
            document.getElementById('postDescription').addEventListener('input', updateCharCount);

            // Submit post
            document.getElementById('submitPostBtn').addEventListener('click', handleSubmitPost);

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => handleFilterChange(btn.dataset.filter));
            });

            // Close dropdowns on outside click
            document.addEventListener('click', closeAllDropdowns);

            // Update current user display
            document.getElementById('currentUserAvatar').textContent = AppData.currentUser.initials || "U";
            document.getElementById('currentUserName').textContent = AppData.currentUser.name || "User";

            // User profile click
            document.getElementById('userProfile').addEventListener('click', () => {
                handleOpenProfile(AppData.currentUser.id);
            });
        }

        // ==================== INITIALIZATION ====================
        function initializeApp() {
            // Add some sample notifications
            AppData.notifications = [
                {
                    id: generateId(),
                    type: 'like',
                    fromUserId: 2,
                    fromUser: { name: "Ama Serwaa", initials: "AS", color: "#e91e63" },
                    postId: "post1",
                    content: "",
                    timestamp: Date.now() - 300000,
                    read: false
                },
                {
                    id: generateId(),
                    type: 'comment',
                    fromUserId: 3,
                    fromUser: { name: "Kweku Mensah", initials: "KM", color: "#2196f3" },
                    postId: "post1",
                    content: "Great post! Really enjoyed reading this.",
                    timestamp: Date.now() - 1800000,
                    read: false
                },
                {
                    id: generateId(),
                    type: 'follow',
                    fromUserId: 4,
                    fromUser: { name: "Efua Owusu", initials: "EO", color: "#9c27b0" },
                    postId: null,
                    content: "",
                    timestamp: Date.now() - 7200000,
                    read: true
                },
                {
                    id: generateId(),
                    type: 'share',
                    fromUserId: 5,
                    fromUser: { name: "Yaw Boateng", initials: "YB", color: "#ff9800" },
                    postId: "post2",
                    content: "",
                    timestamp: Date.now() - 86400000,
                    read: true
                }
            ];

            renderTrends();
            renderDepartments();
            renderPosts();
            renderNotifications();
            updateNotificationBadge();
            attachGlobalListeners();
        }

        // Start the app
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>