<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - CampusTrend UEW</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/user-profile.css">
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1877f2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="CampusTrend">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo" onclick="goToHome()">
            <i class="fas fa-graduation-cap"></i>
            <div>
                <span>CampusTrend</span>
                <div class="logo-subtitle">University of Education, Winneba</div>
            </div>
        </div>
        <div class="header-actions">
            <button class="header-btn" onclick="goToHome()">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="header-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </header>

    <!-- Profile Container -->
    <div class="profile-container">
        <!-- Profile Header Section -->
        <div class="profile-header-section">
            <!-- Avatar Section -->
            <div class="avatar-section">
                <div class="avatar-wrapper">
                    <div class="profile-avatar" id="profileAvatar">
                        <img id="avatarImage" style="display: none;" alt="Profile Avatar">
                        <span id="avatarInitials">U</span>
                    </div>
                    <button class="avatar-edit-btn" id="editAvatarBtn" onclick="openAvatarModal()" style="display: none;">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
            </div>

            <!-- Profile Info -->
            <div class="profile-info-section">
                <h1 class="profile-name" id="profileName">Loading...</h1>
                <div class="profile-meta">
                    <span class="profile-username" id="profileUsername">@student</span>
                    <span class="profile-separator">â€¢</span>
                    <span class="profile-department" id="profileDepartment">Department</span>
                </div>
                <div class="profile-bio" id="profileBio"></div>
                
                <!-- Edit Profile Button (only for own profile) -->
                <button class="edit-profile-btn" id="editProfileBtn" onclick="openEditModal()" style="display: none;">
                    <i class="fas fa-edit"></i>
                    Edit Profile
                </button>
                
                <!-- Follow Button (only for other users) -->
                <button class="follow-btn" id="followBtn" style="display: none;">
                    <i class="fas fa-user-plus"></i>
                    <span id="followBtnText">Follow</span>
                </button>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-icon followers">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="followersCount">0</div>
                    <div class="stat-label">Followers</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon following">
                    <i class="fas fa-user-friends"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="followingCount">0</div>
                    <div class="stat-label">Following</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon likes">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalLikes">0</div>
                    <div class="stat-label">Total Likes</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon stars">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalStars">0</div>
                    <div class="stat-label">Total Stars</div>
                </div>
            </div>
        </div>

        <!-- Posts Section -->
        <div class="posts-section">
            <div class="posts-header">
                <h2 class="posts-title">
                    <i class="fas fa-image"></i>
                    Posts
                </h2>
                <div class="posts-count" id="postsCountDisplay">0 posts</div>
            </div>

            <div class="posts-container" id="postsContainer">
                <!-- Posts will be dynamically loaded here -->
            </div>

            <div class="no-posts" id="noPosts" style="display: none;">
                <i class="fas fa-image"></i>
                <h3>No posts yet</h3>
                <p id="noPostsMessage">No posts to display</p>
            </div>
        </div>
    </div>

    <!-- Avatar Upload Modal -->
    <div class="modal-overlay" id="avatarModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Change Profile Picture</h2>
                <button class="modal-close" onclick="closeAvatarModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="avatar-upload-area" id="avatarUploadArea">
                    <div class="avatar-preview-large" id="avatarPreviewContainer">
                        <img id="avatarPreview" style="display: none;" alt="Avatar Preview">
                        <span id="avatarPreviewInitials">U</span>
                    </div>
                    <button class="upload-avatar-btn" onclick="document.getElementById('avatarInput').click()">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Choose Photo
                    </button>
                    <p class="upload-hint">JPG, PNG or GIF (Max 5MB)</p>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAvatarModal()">Cancel</button>
                <button class="btn-primary" id="saveAvatarBtn" onclick="saveAvatar()" disabled>
                    <span id="saveAvatarText">Save Photo</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="editProfileModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Edit Profile</h2>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="editName" placeholder="Enter your full name" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-textarea" id="editBio" placeholder="Tell us about yourself" maxlength="200"></textarea>
                        <div class="char-count"><span id="bioCharCount">0</span>/200</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input type="text" class="form-input" id="editLocation" placeholder="Your location" maxlength="100">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                <button class="btn-primary" onclick="saveProfile()">
                    <span id="saveProfileText">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Success!</span>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="scripts/user-profile.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/campusTrend/sw.js');
            });
        }
    </script>
</body>
</html>